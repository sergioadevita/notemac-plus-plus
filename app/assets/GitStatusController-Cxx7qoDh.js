import{z as l,o as d,B as h,D as p,N as g,u as m}from"./index-DKn5mDFJ.js";import"./react-vendor-P8ZuH1e3.js";import"./monaco-editor-C1KnpKkb.js";function f(){return m.getState()}function y(a){const t=[],e=[],o=[],c=a.length;for(let s=0;s<c;s++){const[r,n,i,u]=a[s];if(n===0&&i===2&&u===0){o.push({path:r,status:"untracked",isStaged:!1});continue}if(n===0&&i===2&&u===2){t.push({path:r,status:"added",isStaged:!0});continue}if(n===0&&i===0&&u===2){t.push({path:r,status:"added",isStaged:!0});continue}if(n===1&&i===2&&u===2){t.push({path:r,status:"modified",isStaged:!0});continue}if(n===1&&i===2&&u===3){t.push({path:r,status:"modified",isStaged:!0}),e.push({path:r,status:"modified",isStaged:!1});continue}if(n===1&&i===2&&u===1){e.push({path:r,status:"modified",isStaged:!1});continue}if(n===1&&i===0&&u===0){t.push({path:r,status:"deleted",isStaged:!0});continue}if(n===1&&i===0&&u===1){e.push({path:r,status:"deleted",isStaged:!1});continue}}return{branch:f().currentBranch,isRepoDirty:0<t.length+e.length+o.length,stagedFiles:t,unstagedFiles:e,untrackedFiles:o,aheadBy:0,behindBy:0,mergeInProgress:!1}}async function S(){const a=f(),t=l();if(!(t===null||!a.isRepoInitialized))try{const e=h();try{const s=await d.currentBranch({fs:t,dir:e,fullname:!1})||"HEAD";a.SetCurrentBranch(s)}catch{}const o=await d.statusMatrix({fs:t,dir:e}),c=y(o);c.branch=a.currentBranch,a.SetGitStatus(c),p(g.GIT_STATUS_CHANGED)}catch{a.SetGitStatus(null)}}async function F(a){const t=l();if(t!==null)try{await d.add({fs:t,dir:h(),filepath:a}),await S()}catch(e){f().SetGitOperationError(e instanceof Error?e.message:String(e))}}async function B(){const t=f().gitStatus;if(t===null)return;const e=l();if(e===null)return;const o=h(),c=[...t.unstagedFiles.map(s=>s.path),...t.untrackedFiles.map(s=>s.path)];await Promise.allSettled(c.map(s=>d.add({fs:e,dir:o,filepath:s}))),await S()}async function D(a){const t=l();if(t!==null)try{await d.resetIndex({fs:t,dir:h(),filepath:a}),await S()}catch(e){f().SetGitOperationError(e instanceof Error?e.message:String(e))}}async function T(a){const t=l();if(t!==null)try{await d.checkout({fs:t,dir:h(),filepaths:[a],force:!0}),await S()}catch(e){f().SetGitOperationError(e instanceof Error?e.message:String(e))}}export{T as DiscardFileChanges,S as RefreshGitStatus,B as StageAllFiles,F as StageFile,D as UnstageFile};
