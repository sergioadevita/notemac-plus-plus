const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./GitStatusController-QLZuuykr.js","./index-DshWawKp.js","./react-vendor-P8ZuH1e3.js","./monaco-editor-BYMRfcD5.js","./monaco-editor-C3yYqDe4.css","./index-BEzU1RrQ.css","./GitLogController-CmwC7VjS.js","./GitBranchController-KTkaQHvx.js"])))=>i.map(i=>d[i]);
import{z as O,o as _,A as k,D as R,N as G,u as d,p as D,r as u,B as ne,j as r,E as ie,F as K,J as V,K as Y,L as se}from"./index-DshWawKp.js";import{UnstageFile as ae,StageAllFiles as q,StageFile as J,DiscardFileChanges as le}from"./GitStatusController-QLZuuykr.js";import{_ as S}from"./monaco-editor-BYMRfcD5.js";import{CreateBranch as ce,CheckoutBranch as X}from"./GitBranchController-KTkaQHvx.js";import{GetStagedDiff as de}from"./GitLogController-CmwC7VjS.js";import"./react-vendor-P8ZuH1e3.js";function pe(){return d.getState()}async function Q(t){const o=pe(),s=O();if(s===null)throw new Error("No filesystem available");try{o.SetGitOperationInProgress(!0),o.SetCurrentGitOperation("commit"),o.SetGitOperationError(null);const i=o.gitAuthor,n=await _.commit({fs:s,dir:k(),message:t,author:{name:i.name,email:i.email}}),{RefreshGitStatus:a}=await S(async()=>{const{RefreshGitStatus:x}=await import("./GitStatusController-QLZuuykr.js");return{RefreshGitStatus:x}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),{FetchCommitLog:g}=await S(async()=>{const{FetchCommitLog:x}=await import("./GitLogController-CmwC7VjS.js");return{FetchCommitLog:x}},__vite__mapDeps([6,1,2,3,4,5]),import.meta.url);return await a(),await g(),R(G.GIT_OPERATION_COMPLETE,{operation:"commit",oid:n}),n}catch(i){throw o.SetGitOperationError(i instanceof Error?i.message:String(i)),i}finally{o.SetGitOperationInProgress(!1),o.SetCurrentGitOperation(null)}}function j(){return d.getState()}function F(){const t=j(),{GIT_DEFAULT_CORS_PROXY:o}=require("../../Commons/Constants");return t.gitSettings.corsProxy||o}function $(t){const o=t||j().gitCredentials;if(o!=null)return()=>({username:o.username||o.token||"",password:o.token||""})}async function Z(t="origin"){const o=j(),s=O();if(s!==null)try{o.SetGitOperationInProgress(!0),o.SetCurrentGitOperation("push"),o.SetGitOperationError(null),await _.push({fs:s,http:D,dir:k(),remote:t,ref:o.currentBranch,corsProxy:F(),onAuth:$(),onProgress:n=>{n.total&&o.SetGitOperationProgress(Math.round(n.loaded/n.total*100))}});const{RefreshGitStatus:i}=await S(async()=>{const{RefreshGitStatus:n}=await import("./GitStatusController-QLZuuykr.js");return{RefreshGitStatus:n}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);await i(),R(G.GIT_OPERATION_COMPLETE,{operation:"push"})}catch(i){throw o.SetGitOperationError(i instanceof Error?i.message:String(i)),i}finally{o.SetGitOperationInProgress(!1),o.SetCurrentGitOperation(null),o.SetGitOperationProgress(0)}}async function ue(t="origin"){const o=j(),s=O();if(s!==null)try{o.SetGitOperationInProgress(!0),o.SetCurrentGitOperation("pull"),o.SetGitOperationError(null),await _.pull({fs:s,http:D,dir:k(),ref:o.currentBranch,singleBranch:!0,corsProxy:F(),onAuth:$(),author:{name:o.gitAuthor.name,email:o.gitAuthor.email}});const{RefreshGitStatus:i}=await S(async()=>{const{RefreshGitStatus:a}=await import("./GitStatusController-QLZuuykr.js");return{RefreshGitStatus:a}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),{FetchCommitLog:n}=await S(async()=>{const{FetchCommitLog:a}=await import("./GitLogController-CmwC7VjS.js");return{FetchCommitLog:a}},__vite__mapDeps([6,1,2,3,4,5]),import.meta.url);await i(),await n(),R(G.GIT_OPERATION_COMPLETE,{operation:"pull"})}catch(i){throw o.SetGitOperationError(i instanceof Error?i.message:String(i)),i}finally{o.SetGitOperationInProgress(!1),o.SetCurrentGitOperation(null),o.SetGitOperationProgress(0)}}async function ge(t="origin"){const o=j(),s=O();if(s!==null)try{o.SetGitOperationInProgress(!0),o.SetCurrentGitOperation("fetch"),o.SetGitOperationError(null),await _.fetch({fs:s,http:D,dir:k(),remote:t,corsProxy:F(),onAuth:$()});const{RefreshBranches:i}=await S(async()=>{const{RefreshBranches:n}=await import("./GitBranchController-KTkaQHvx.js");return{RefreshBranches:n}},__vite__mapDeps([7,3,4,1,2,5]),import.meta.url);await i(),R(G.GIT_OPERATION_COMPLETE,{operation:"fetch"})}catch(i){o.SetGitOperationError(i instanceof Error?i.message:String(i))}finally{o.SetGitOperationInProgress(!1),o.SetCurrentGitOperation(null)}}const xe={modified:"#f9e2af",added:"#a6e3a1",deleted:"#f38ba8",untracked:"#6c7086",unmerged:"#cba6f7"},fe={modified:"M",added:"A",deleted:"D",untracked:"U",unmerged:"!"};function he(t){const s=Date.now()/1e3-t;return K>s?"just now":V>s?`${Math.floor(s/K)}m ago`:Y>s?`${Math.floor(s/V)}h ago`:se>s?`${Math.floor(s/Y)}d ago`:new Date(t*1e3).toLocaleDateString()}function je({theme:t}){var N,H;const o=d(e=>e.isRepoInitialized),s=d(e=>e.currentBranch),i=d(e=>e.branches),n=d(e=>e.gitStatus),a=d(e=>e.commitLog),g=d(e=>e.isGitOperationInProgress),x=d(e=>e.gitOperationProgress),E=d(e=>e.gitOperationError),y=d(e=>e.isBrowserWorkspace),l=d(e=>e.setShowCloneDialog),[c,h]=u.useState(""),[f,b]=u.useState(!1),[p,I]=u.useState({staged:!0,changes:!0,untracked:!0,commits:!1,branches:!1}),[P,T]=u.useState(!1),[v,L]=u.useState(""),[B,z]=u.useState(null),C=u.useCallback(e=>{I(w=>({...w,[e]:!w[e]}))},[]),M=u.useCallback(async()=>{if(c.trim().length!==0)try{await Q(c.trim()),h("")}catch{}},[c]),ee=u.useCallback(async()=>{if(c.trim().length!==0)try{await Q(c.trim()),h(""),await Z()}catch{}},[c]),te=u.useCallback(e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),M())},[M]),re=u.useCallback(async()=>{var w;if(!((((w=n==null?void 0:n.stagedFiles)==null?void 0:w.length)||0)===0||f)){b(!0);try{const W=await de();if(W.length===0){b(!1);return}h(""),await ne(W,U=>{h(d.getState().commitMessageDraft)},U=>{h(U)})}catch{}finally{b(!1)}}},[n,f]),oe=u.useCallback(async()=>{v.trim().length!==0&&(await ce(v.trim()),L(""),T(!1))},[v]);if(!o)return r.jsxs("div",{style:{padding:24,display:"flex",flexDirection:"column",alignItems:"center",gap:12,textAlign:"center"},children:[r.jsx("div",{style:{fontSize:32,opacity:.3},children:"ðŸ”€"}),r.jsx("div",{style:{color:t.textMuted,fontSize:13},children:"This folder is not a git repository"}),r.jsx("button",{onClick:()=>ie(),style:{backgroundColor:t.accent,color:t.accentText,border:"none",borderRadius:6,padding:"8px 16px",cursor:"pointer",fontSize:13,width:"100%"},children:"Initialize Repository"}),r.jsx("button",{onClick:()=>l(!0),style:{backgroundColor:t.bgHover,color:t.text,border:`1px solid ${t.border}`,borderRadius:6,padding:"8px 16px",cursor:"pointer",fontSize:13,width:"100%"},children:"Clone Repository"})]});const m=(n==null?void 0:n.stagedFiles.length)||0;return r.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[y&&r.jsx("div",{style:{padding:"4px 8px",backgroundColor:"#f9e2af22",borderBottom:`1px solid ${t.border}`,fontSize:10,color:"#f9e2af",textAlign:"center"},children:"âš  Browser Workspace â€” files stored in browser only"}),E!==null&&r.jsxs("div",{style:{padding:"6px 8px",backgroundColor:"#f38ba822",borderBottom:`1px solid ${t.border}`,fontSize:11,color:"#f38ba8",display:"flex",alignItems:"center",gap:6},children:[r.jsx("span",{style:{flex:1},children:E}),r.jsx("span",{style:{cursor:"pointer",opacity:.7},onClick:()=>d.getState().SetGitOperationError(null),children:"âœ•"})]}),g&&r.jsx("div",{style:{height:2,backgroundColor:t.border},children:r.jsx("div",{style:{height:"100%",backgroundColor:t.accent,width:`${0<x?x:100}%`,transition:"width 0.3s",animation:x===0?"pulse 1.5s infinite":"none"}})}),r.jsxs("div",{style:{flex:1,overflow:"auto"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderBottom:`1px solid ${t.border}`,fontSize:12},children:[r.jsx("span",{style:{color:t.accent},children:"âŽ‡"}),r.jsx("select",{value:s,onChange:e=>X(e.target.value),style:{flex:1,backgroundColor:"transparent",color:t.text,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",outline:"none"},children:i.filter(e=>!e.isRemote).map(e=>r.jsx("option",{value:e.name,style:{backgroundColor:t.bg,color:t.text},children:e.name},e.name))}),n&&(0<n.aheadBy||0<n.behindBy)&&r.jsxs("span",{style:{color:t.textMuted,fontSize:11},children:[0<n.aheadBy&&`â†‘${n.aheadBy}`,0<n.behindBy&&` â†“${n.behindBy}`]})]}),r.jsx("div",{style:{display:"flex",gap:4,padding:"6px 8px",borderBottom:`1px solid ${t.border}`},children:[{label:"â¬‡ Pull",action:()=>ue(),disabled:g},{label:"â¬† Push",action:()=>Z(),disabled:g},{label:"ðŸ”„ Fetch",action:()=>ge(),disabled:g}].map(e=>r.jsx("button",{onClick:e.action,disabled:e.disabled,style:{flex:1,height:26,backgroundColor:t.bgHover,color:t.text,border:`1px solid ${t.border}`,borderRadius:4,fontSize:11,cursor:e.disabled?"not-allowed":"pointer",opacity:e.disabled?.5:1},children:e.label},e.label))}),r.jsxs("div",{style:{padding:"8px 8px",borderBottom:`1px solid ${t.border}`},children:[r.jsxs("div",{style:{position:"relative"},children:[r.jsx("textarea",{value:c,onChange:e=>h(e.target.value),onKeyDown:te,placeholder:"Commit message (Cmd+Enter to commit)",style:{width:"100%",height:52,backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,borderRadius:4,padding:"6px 8px",paddingRight:30,fontSize:12,resize:"none",fontFamily:"inherit",boxSizing:"border-box"}}),r.jsx("button",{onClick:re,disabled:f||(((N=n==null?void 0:n.stagedFiles)==null?void 0:N.length)||0)===0,title:"Generate commit message with AI",style:{position:"absolute",top:4,right:4,width:22,height:22,background:"none",border:"none",cursor:f?"wait":"pointer",fontSize:12,opacity:f||(((H=n==null?void 0:n.stagedFiles)==null?void 0:H.length)||0)===0?.4:.8,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"},children:f?"â³":"âœ¨"})]}),r.jsxs("div",{style:{display:"flex",gap:4,marginTop:4},children:[r.jsx("button",{onClick:M,disabled:c.trim().length===0||g||m===0,style:{flex:1,height:26,backgroundColor:t.accent,color:t.accentText,border:"none",borderRadius:4,fontSize:12,fontWeight:600,cursor:c.trim().length===0||m===0?"not-allowed":"pointer",opacity:c.trim().length===0||m===0?.5:1},children:"âœ“ Commit"}),r.jsx("button",{onClick:ee,disabled:c.trim().length===0||g||m===0,title:"Commit & Push",style:{width:36,height:26,backgroundColor:t.bgHover,color:t.text,border:`1px solid ${t.border}`,borderRadius:4,fontSize:11,cursor:c.trim().length===0||m===0?"not-allowed":"pointer",opacity:c.trim().length===0||m===0?.5:1},children:"âœ“â¬†"})]})]}),r.jsx(A,{title:"Staged Changes",sectionKey:"staged",files:(n==null?void 0:n.stagedFiles)||[],expanded:p.staged,onToggle:C,theme:t,hoveredFile:B,onHover:z,actions:e=>[{label:"âˆ’",title:"Unstage",action:()=>ae(e.path)}],headerAction:{label:"âˆ’",title:"Unstage all",action:()=>{}}}),r.jsx(A,{title:"Changes",sectionKey:"changes",files:(n==null?void 0:n.unstagedFiles)||[],expanded:p.changes,onToggle:C,theme:t,hoveredFile:B,onHover:z,actions:e=>[{label:"+",title:"Stage",action:()=>J(e.path)},{label:"â†©",title:"Discard changes",action:()=>le(e.path)}],headerAction:{label:"+",title:"Stage all",action:()=>q()}}),r.jsx(A,{title:"Untracked",sectionKey:"untracked",files:(n==null?void 0:n.untrackedFiles)||[],expanded:p.untracked,onToggle:C,theme:t,hoveredFile:B,onHover:z,actions:e=>[{label:"+",title:"Stage",action:()=>J(e.path)}],headerAction:{label:"+",title:"Stage all untracked",action:()=>q()}}),r.jsxs("div",{style:{borderBottom:`1px solid ${t.border}`},children:[r.jsxs("div",{onClick:()=>C("commits"),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:.5,color:t.textSecondary},children:[r.jsxs("span",{children:[p.commits?"â–¼":"â–¶"," Recent Commits"]}),r.jsx("span",{style:{backgroundColor:t.bgHover,fontSize:10,borderRadius:8,padding:"1px 6px"},children:a.length})]}),p.commits&&r.jsx("div",{style:{padding:"0 12px 4px"},children:a.slice(0,20).map(e=>r.jsxs("div",{style:{fontSize:11,padding:"2px 0",display:"flex",alignItems:"baseline",gap:6},children:[r.jsx("span",{style:{color:"#f9e2af",fontFamily:"monospace",fontSize:10,flexShrink:0},children:e.oid.slice(0,7)}),r.jsx("span",{style:{color:t.text,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message.split(`
`)[0]}),r.jsx("span",{style:{color:t.textMuted,fontSize:10,whiteSpace:"nowrap",flexShrink:0},children:he(e.timestamp)})]},e.oid))})]}),r.jsxs("div",{style:{borderBottom:`1px solid ${t.border}`},children:[r.jsxs("div",{onClick:()=>C("branches"),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:.5,color:t.textSecondary},children:[r.jsxs("span",{children:[p.branches?"â–¼":"â–¶"," Branches"]}),r.jsx("span",{style:{backgroundColor:t.bgHover,fontSize:10,borderRadius:8,padding:"1px 6px"},children:i.length})]}),p.branches&&r.jsxs("div",{style:{padding:"0 12px 4px"},children:[i.map(e=>r.jsxs("div",{onClick:()=>!e.isRemote&&!e.isCurrentBranch&&X(e.name),style:{fontSize:12,padding:"3px 0",display:"flex",alignItems:"center",gap:6,cursor:e.isRemote||e.isCurrentBranch?"default":"pointer"},children:[r.jsx("span",{style:{color:e.isCurrentBranch?t.accent:e.isRemote?t.textMuted:t.textSecondary},children:e.isCurrentBranch?"â—":e.isRemote?"â—Œ":"â—‹"}),r.jsx("span",{style:{color:e.isCurrentBranch?t.text:e.isRemote?t.textMuted:t.textSecondary,fontWeight:e.isCurrentBranch?600:400},children:e.name}),e.isCurrentBranch&&r.jsx("span",{style:{color:t.textMuted,fontSize:10,marginLeft:"auto"},children:"current"}),e.isRemote&&r.jsx("span",{style:{color:t.textMuted,fontSize:10,marginLeft:"auto"},children:"remote"})]},e.name)),P?r.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:r.jsx("input",{autoFocus:!0,value:v,onChange:e=>L(e.target.value),onKeyDown:e=>{e.key==="Enter"&&oe(),e.key==="Escape"&&T(!1)},placeholder:"branch-name",style:{flex:1,height:22,fontSize:11,backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,borderRadius:3,padding:"0 6px"}})}):r.jsx("div",{onClick:()=>T(!0),style:{fontSize:11,color:t.accent,cursor:"pointer",padding:"4px 0",marginTop:4},children:"+ New Branch"})]})]})]})]})}function A({title:t,sectionKey:o,files:s,expanded:i,onToggle:n,theme:a,hoveredFile:g,onHover:x,actions:E,headerAction:y}){return s.length===0?null:r.jsxs("div",{style:{borderBottom:`1px solid ${a.border}`},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:.5,color:a.textSecondary},children:[r.jsxs("span",{onClick:()=>n(o),children:[i?"â–¼":"â–¶"," ",t]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[y&&r.jsx("span",{onClick:l=>{l.stopPropagation(),y.action()},title:y.title,style:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,cursor:"pointer",fontSize:13,color:a.textSecondary},children:y.label}),r.jsx("span",{style:{backgroundColor:a.bgHover,fontSize:10,borderRadius:8,padding:"1px 6px",color:a.text},children:s.length})]})]}),i&&s.map(l=>{const c=g===`${o}-${l.path}`,h=l.path.split("/").pop()||l.path,f=l.path.includes("/")?l.path.substring(0,l.path.lastIndexOf("/")+1):"",b=E(l);return r.jsxs("div",{onMouseEnter:()=>x(`${o}-${l.path}`),onMouseLeave:()=>x(null),style:{display:"flex",alignItems:"center",gap:6,padding:"3px 12px 3px 20px",fontSize:12,cursor:"pointer",backgroundColor:c?a.bgHover:"transparent"},children:[r.jsx("span",{style:{fontSize:10,fontWeight:700,width:14,textAlign:"center",color:xe[l.status]||a.textMuted,flexShrink:0},children:fe[l.status]||"?"}),r.jsxs("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:a.text},children:[h,f!==""&&r.jsx("span",{style:{color:a.textMuted,fontSize:10,marginLeft:4},children:f})]}),c&&r.jsx("div",{style:{display:"flex",gap:2,flexShrink:0},children:b.map((p,I)=>r.jsx("span",{onClick:P=>{P.stopPropagation(),p.action()},title:p.title,style:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,cursor:"pointer",fontSize:12,color:a.textSecondary},children:p.label},`${l.path}-action-${I}-${p.label}`))})]},l.path)})]})}export{je as GitPanelViewPresenter};
