import{u as l,r as d,z as P,P as O,A as Y,B as J,E as Q,j as t,F as X,J as _,K as Z,L as q,M as ee,O as A,Q as H,V as te,W,X as G,Y as N,Z as oe}from"./index-DVYlFcWN.js";import"./react-vendor-P8ZuH1e3.js";import"./monaco-editor-C1KnpKkb.js";const ne={modified:"#f9e2af",added:"#a6e3a1",deleted:"#f38ba8",untracked:"#6c7086",unmerged:"#cba6f7"},re={modified:"M",added:"A",deleted:"D",untracked:"U",unmerged:"!"};function ie(o){const s=Date.now()/1e3-o;return W>s?"just now":G>s?`${Math.floor(s/W)}m ago`:N>s?`${Math.floor(s/G)}h ago`:oe>s?`${Math.floor(s/N)}d ago`:new Date(o*1e3).toLocaleDateString()}function de({theme:o}){var T,F;const u=l(e=>e.isRepoInitialized),s=l(e=>e.currentBranch),f=l(e=>e.branches),n=l(e=>e.gitStatus),a=l(e=>e.commitLog),x=l(e=>e.isGitOperationInProgress);l(e=>e.currentGitOperation);const h=l(e=>e.gitOperationProgress),m=l(e=>e.gitOperationError),y=l(e=>e.isBrowserWorkspace),i=l(e=>e.setShowCloneDialog),[r,g]=d.useState(""),[p,C]=d.useState(!1),[c,v]=d.useState({staged:!0,changes:!0,untracked:!0,commits:!1,branches:!1}),[w,z]=d.useState(!1),[k,M]=d.useState(""),[R,B]=d.useState(null),S=d.useCallback(e=>{v(j=>({...j,[e]:!j[e]}))},[]),E=d.useCallback(async()=>{if(r.trim().length!==0)try{await P(r.trim()),g("")}catch{}},[r]),L=d.useCallback(async()=>{if(r.trim().length!==0)try{await P(r.trim()),g(""),await O()}catch{}},[r]),U=d.useCallback(e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),E())},[E]),K=d.useCallback(async()=>{var j;if(!((((j=n==null?void 0:n.stagedFiles)==null?void 0:j.length)||0)===0||p)){C(!0);try{const $=await Y();if($.length===0){C(!1);return}g(""),await J($,D=>{g(l.getState().commitMessageDraft)},D=>{g(D)})}catch{}finally{C(!1)}}},[n,p]),V=d.useCallback(async()=>{k.trim().length!==0&&(await Q(k.trim()),M(""),z(!1))},[k]);if(!u)return t.jsxs("div",{style:{padding:24,display:"flex",flexDirection:"column",alignItems:"center",gap:12,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:32,opacity:.3},children:"ðŸ”€"}),t.jsx("div",{style:{color:o.textMuted,fontSize:13},children:"This folder is not a git repository"}),t.jsx("button",{onClick:()=>X(),style:{backgroundColor:o.accent,color:o.accentText,border:"none",borderRadius:6,padding:"8px 16px",cursor:"pointer",fontSize:13,width:"100%"},children:"Initialize Repository"}),t.jsx("button",{onClick:()=>i(!0),style:{backgroundColor:o.bgHover,color:o.text,border:`1px solid ${o.border}`,borderRadius:6,padding:"8px 16px",cursor:"pointer",fontSize:13,width:"100%"},children:"Clone Repository"})]});const b=(n==null?void 0:n.stagedFiles.length)||0;return n!=null&&n.unstagedFiles.length,n!=null&&n.untrackedFiles.length,t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[y&&t.jsx("div",{style:{padding:"4px 8px",backgroundColor:"#f9e2af22",borderBottom:`1px solid ${o.border}`,fontSize:10,color:"#f9e2af",textAlign:"center"},children:"âš  Browser Workspace â€” files stored in browser only"}),m!==null&&t.jsxs("div",{style:{padding:"6px 8px",backgroundColor:"#f38ba822",borderBottom:`1px solid ${o.border}`,fontSize:11,color:"#f38ba8",display:"flex",alignItems:"center",gap:6},children:[t.jsx("span",{style:{flex:1},children:m}),t.jsx("span",{style:{cursor:"pointer",opacity:.7},onClick:()=>l.getState().SetGitOperationError(null),children:"âœ•"})]}),x&&t.jsx("div",{style:{height:2,backgroundColor:o.border},children:t.jsx("div",{style:{height:"100%",backgroundColor:o.accent,width:`${0<h?h:100}%`,transition:"width 0.3s",animation:h===0?"pulse 1.5s infinite":"none"}})}),t.jsxs("div",{style:{flex:1,overflow:"auto"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderBottom:`1px solid ${o.border}`,fontSize:12},children:[t.jsx("span",{style:{color:o.accent},children:"âŽ‡"}),t.jsx("select",{value:s,onChange:e=>_(e.target.value),style:{flex:1,backgroundColor:"transparent",color:o.text,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",outline:"none"},children:f.filter(e=>!e.isRemote).map(e=>t.jsx("option",{value:e.name,style:{backgroundColor:o.bg,color:o.text},children:e.name},e.name))}),n&&(0<n.aheadBy||0<n.behindBy)&&t.jsxs("span",{style:{color:o.textMuted,fontSize:11},children:[0<n.aheadBy&&`â†‘${n.aheadBy}`,0<n.behindBy&&` â†“${n.behindBy}`]})]}),t.jsx("div",{style:{display:"flex",gap:4,padding:"6px 8px",borderBottom:`1px solid ${o.border}`},children:[{label:"â¬‡ Pull",action:()=>Z(),disabled:x},{label:"â¬† Push",action:()=>O(),disabled:x},{label:"ðŸ”„ Fetch",action:()=>q(),disabled:x}].map(e=>t.jsx("button",{onClick:e.action,disabled:e.disabled,style:{flex:1,height:26,backgroundColor:o.bgHover,color:o.text,border:`1px solid ${o.border}`,borderRadius:4,fontSize:11,cursor:e.disabled?"not-allowed":"pointer",opacity:e.disabled?.5:1},children:e.label},e.label))}),t.jsxs("div",{style:{padding:"8px 8px",borderBottom:`1px solid ${o.border}`},children:[t.jsxs("div",{style:{position:"relative"},children:[t.jsx("textarea",{value:r,onChange:e=>g(e.target.value),onKeyDown:U,placeholder:"Commit message (Cmd+Enter to commit)",style:{width:"100%",height:52,backgroundColor:o.bg,color:o.text,border:`1px solid ${o.border}`,borderRadius:4,padding:"6px 8px",paddingRight:30,fontSize:12,resize:"none",fontFamily:"inherit",boxSizing:"border-box"}}),t.jsx("button",{onClick:K,disabled:p||(((T=n==null?void 0:n.stagedFiles)==null?void 0:T.length)||0)===0,title:"Generate commit message with AI",style:{position:"absolute",top:4,right:4,width:22,height:22,background:"none",border:"none",cursor:p?"wait":"pointer",fontSize:12,opacity:p||(((F=n==null?void 0:n.stagedFiles)==null?void 0:F.length)||0)===0?.4:.8,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"},children:p?"â³":"âœ¨"})]}),t.jsxs("div",{style:{display:"flex",gap:4,marginTop:4},children:[t.jsx("button",{onClick:E,disabled:r.trim().length===0||x||b===0,style:{flex:1,height:26,backgroundColor:o.accent,color:o.accentText,border:"none",borderRadius:4,fontSize:12,fontWeight:600,cursor:r.trim().length===0||b===0?"not-allowed":"pointer",opacity:r.trim().length===0||b===0?.5:1},children:"âœ“ Commit"}),t.jsx("button",{onClick:L,disabled:r.trim().length===0||x||b===0,title:"Commit & Push",style:{width:36,height:26,backgroundColor:o.bgHover,color:o.text,border:`1px solid ${o.border}`,borderRadius:4,fontSize:11,cursor:r.trim().length===0||b===0?"not-allowed":"pointer",opacity:r.trim().length===0||b===0?.5:1},children:"âœ“â¬†"})]})]}),t.jsx(I,{title:"Staged Changes",sectionKey:"staged",files:(n==null?void 0:n.stagedFiles)||[],expanded:c.staged,onToggle:S,theme:o,hoveredFile:R,onHover:B,actions:e=>[{label:"âˆ’",title:"Unstage",action:()=>ee(e.path)}],headerAction:{label:"âˆ’",title:"Unstage all",action:()=>{}}}),t.jsx(I,{title:"Changes",sectionKey:"changes",files:(n==null?void 0:n.unstagedFiles)||[],expanded:c.changes,onToggle:S,theme:o,hoveredFile:R,onHover:B,actions:e=>[{label:"+",title:"Stage",action:()=>H(e.path)},{label:"â†©",title:"Discard changes",action:()=>te(e.path)}],headerAction:{label:"+",title:"Stage all",action:()=>A()}}),t.jsx(I,{title:"Untracked",sectionKey:"untracked",files:(n==null?void 0:n.untrackedFiles)||[],expanded:c.untracked,onToggle:S,theme:o,hoveredFile:R,onHover:B,actions:e=>[{label:"+",title:"Stage",action:()=>H(e.path)}],headerAction:{label:"+",title:"Stage all untracked",action:()=>A()}}),t.jsxs("div",{style:{borderBottom:`1px solid ${o.border}`},children:[t.jsxs("div",{onClick:()=>S("commits"),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:.5,color:o.textSecondary},children:[t.jsxs("span",{children:[c.commits?"â–¼":"â–¶"," Recent Commits"]}),t.jsx("span",{style:{backgroundColor:o.bgHover,fontSize:10,borderRadius:8,padding:"1px 6px"},children:a.length})]}),c.commits&&t.jsx("div",{style:{padding:"0 12px 4px"},children:a.slice(0,20).map(e=>t.jsxs("div",{style:{fontSize:11,padding:"2px 0",display:"flex",alignItems:"baseline",gap:6},children:[t.jsx("span",{style:{color:"#f9e2af",fontFamily:"monospace",fontSize:10,flexShrink:0},children:e.oid.slice(0,7)}),t.jsx("span",{style:{color:o.text,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message.split(`
`)[0]}),t.jsx("span",{style:{color:o.textMuted,fontSize:10,whiteSpace:"nowrap",flexShrink:0},children:ie(e.timestamp)})]},e.oid))})]}),t.jsxs("div",{style:{borderBottom:`1px solid ${o.border}`},children:[t.jsxs("div",{onClick:()=>S("branches"),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:.5,color:o.textSecondary},children:[t.jsxs("span",{children:[c.branches?"â–¼":"â–¶"," Branches"]}),t.jsx("span",{style:{backgroundColor:o.bgHover,fontSize:10,borderRadius:8,padding:"1px 6px"},children:f.length})]}),c.branches&&t.jsxs("div",{style:{padding:"0 12px 4px"},children:[f.map(e=>t.jsxs("div",{onClick:()=>!e.isRemote&&!e.isCurrentBranch&&_(e.name),style:{fontSize:12,padding:"3px 0",display:"flex",alignItems:"center",gap:6,cursor:e.isRemote||e.isCurrentBranch?"default":"pointer"},children:[t.jsx("span",{style:{color:e.isCurrentBranch?o.accent:e.isRemote?o.textMuted:o.textSecondary},children:e.isCurrentBranch?"â—":e.isRemote?"â—Œ":"â—‹"}),t.jsx("span",{style:{color:e.isCurrentBranch?o.text:e.isRemote?o.textMuted:o.textSecondary,fontWeight:e.isCurrentBranch?600:400},children:e.name}),e.isCurrentBranch&&t.jsx("span",{style:{color:o.textMuted,fontSize:10,marginLeft:"auto"},children:"current"}),e.isRemote&&t.jsx("span",{style:{color:o.textMuted,fontSize:10,marginLeft:"auto"},children:"remote"})]},e.name)),w?t.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:t.jsx("input",{autoFocus:!0,value:k,onChange:e=>M(e.target.value),onKeyDown:e=>{e.key==="Enter"&&V(),e.key==="Escape"&&z(!1)},placeholder:"branch-name",style:{flex:1,height:22,fontSize:11,backgroundColor:o.bg,color:o.text,border:`1px solid ${o.border}`,borderRadius:3,padding:"0 6px"}})}):t.jsx("div",{onClick:()=>z(!0),style:{fontSize:11,color:o.accent,cursor:"pointer",padding:"4px 0",marginTop:4},children:"+ New Branch"})]})]})]})]})}function I({title:o,sectionKey:u,files:s,expanded:f,onToggle:n,theme:a,hoveredFile:x,onHover:h,actions:m,headerAction:y}){return s.length===0?null:t.jsxs("div",{style:{borderBottom:`1px solid ${a.border}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",fontSize:11,fontWeight:600,textTransform:"uppercase",letterSpacing:.5,color:a.textSecondary},children:[t.jsxs("span",{onClick:()=>n(u),children:[f?"â–¼":"â–¶"," ",o]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[y&&t.jsx("span",{onClick:i=>{i.stopPropagation(),y.action()},title:y.title,style:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,cursor:"pointer",fontSize:13,color:a.textSecondary},children:y.label}),t.jsx("span",{style:{backgroundColor:a.bgHover,fontSize:10,borderRadius:8,padding:"1px 6px",color:a.text},children:s.length})]})]}),f&&s.map(i=>{const r=x===`${u}-${i.path}`,g=i.path.split("/").pop()||i.path,p=i.path.includes("/")?i.path.substring(0,i.path.lastIndexOf("/")+1):"",C=m(i);return t.jsxs("div",{onMouseEnter:()=>h(`${u}-${i.path}`),onMouseLeave:()=>h(null),style:{display:"flex",alignItems:"center",gap:6,padding:"3px 12px 3px 20px",fontSize:12,cursor:"pointer",backgroundColor:r?a.bgHover:"transparent"},children:[t.jsx("span",{style:{fontSize:10,fontWeight:700,width:14,textAlign:"center",color:ne[i.status]||a.textMuted,flexShrink:0},children:re[i.status]||"?"}),t.jsxs("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:a.text},children:[g,p!==""&&t.jsx("span",{style:{color:a.textMuted,fontSize:10,marginLeft:4},children:p})]}),r&&t.jsx("div",{style:{display:"flex",gap:2,flexShrink:0},children:C.map((c,v)=>t.jsx("span",{onClick:w=>{w.stopPropagation(),c.action()},title:c.title,style:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,cursor:"pointer",fontSize:12,color:a.textSecondary},children:c.label},v))})]},i.path)})]})}export{de as GitPanelViewPresenter};
