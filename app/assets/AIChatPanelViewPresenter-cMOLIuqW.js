import{u as P,r as s,_ as W,j as e,$ as H,a0 as F,a1 as O,a2 as G}from"./index-DZ2o6UUv.js";import"./react-vendor-P8ZuH1e3.js";import"./monaco-editor-BYMRfcD5.js";function J({theme:t}){var M;const{aiEnabled:i,conversations:d,activeConversationId:o,isAiStreaming:r,aiStreamContent:l,aiOperationError:c,activeProviderId:f,activeModelId:x,providers:p,credentials:h,SetActiveConversation:S,AddConversation:_,RemoveConversation:m,SetAiOperationError:E,SetShowAiSettings:j,GetActiveProvider:B,GetCredentialForProvider:R}=P(),[k,w]=s.useState(""),[D,b]=s.useState(!1),z=s.useRef(null),A=s.useRef(null),a=d.find(n=>n.id===o)||null,g=B(),$=g!==null&&R(g.id)!==null,v=k.trim(),u=0<v.length;s.useEffect(()=>{var n;(n=z.current)==null||n.scrollIntoView({behavior:"smooth"})},[(M=a==null?void 0:a.messages)==null?void 0:M.length,l]);const C=s.useCallback(async()=>{if(!(!u||r===!0)){w(""),E(null);try{await W(v)}catch{}}},[v,u,r]),T=s.useCallback(n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),C())},[C]),N=s.useCallback(()=>{F()},[]),I=s.useCallback(()=>{var n;S(null),b(!1),(n=A.current)==null||n.focus()},[]);return $===!1?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:24,gap:12,height:"100%"},children:[e.jsx("div",{style:{fontSize:24},children:"âœ¨"}),e.jsx("div",{style:{color:t.text,fontSize:13,fontWeight:600,textAlign:"center"},children:"AI Assistant"}),e.jsx("div",{style:{color:t.textMuted,fontSize:12,textAlign:"center"},children:"Configure an API key to start using AI features."}),e.jsx("button",{onClick:()=>j(!0),style:{backgroundColor:t.accent,color:t.accentText,border:"none",borderRadius:6,padding:"8px 16px",cursor:"pointer",fontSize:12},children:"Open AI Settings"})]}):D===!0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${t.border}`},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600,color:t.text},children:"Conversations"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:I,title:"New Conversation",style:{background:"none",border:"none",color:t.accent,cursor:"pointer",fontSize:14,padding:"2px 6px"},children:"+"}),e.jsx("button",{onClick:()=>b(!1),title:"Back to Chat",style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:14,padding:"2px 6px"},children:"âœ•"})]})]}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:d.length===0?e.jsx("div",{style:{padding:16,color:t.textMuted,fontSize:12,textAlign:"center"},children:"No conversations yet"}):d.map(n=>e.jsxs("div",{onClick:()=>{S(n.id),b(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:`1px solid ${t.border}`,backgroundColor:n.id===o?t.bgActive:"transparent",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{overflow:"hidden",flex:1},children:[e.jsx("div",{style:{fontSize:12,color:t.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.title}),e.jsxs("div",{style:{fontSize:10,color:t.textMuted,marginTop:2},children:[n.messages.length," messages ","Â·"," ",new Date(n.createdAt).toLocaleDateString()]})]}),e.jsx("button",{onClick:y=>{y.stopPropagation(),m(n.id)},style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:12,padding:"2px 4px",flexShrink:0},children:"âœ•"})]},n.id))})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{padding:"6px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${t.border}`,flexShrink:0},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:e.jsx("span",{style:{fontSize:12,fontWeight:600,color:t.text},children:a?a.title:"New Chat"})}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>b(!0),title:"Conversation History",style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:13,padding:"2px 6px"},children:"ðŸ“‹"}),e.jsx("button",{onClick:I,title:"New Conversation",style:{background:"none",border:"none",color:t.accent,cursor:"pointer",fontSize:13,padding:"2px 6px"},children:"+"}),e.jsx("button",{onClick:()=>j(!0),title:"AI Settings",style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:13,padding:"2px 6px"},children:"âš™"})]})]}),e.jsxs("div",{style:{padding:"4px 12px",fontSize:10,color:t.textMuted,borderBottom:`1px solid ${t.border}`,flexShrink:0},children:[(g==null?void 0:g.name)||"No provider"," ","Â·"," ",x]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"8px 0"},children:[a===null||a.messages.length===0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:24,gap:8},children:[e.jsx("div",{style:{fontSize:20},children:"âœ¨"}),e.jsx("div",{style:{color:t.textMuted,fontSize:12,textAlign:"center"},children:"Ask me anything about your code, or use the context menu on selected code for AI actions."})]}):a.messages.map((n,y)=>e.jsx(K,{message:n,theme:t,isStreaming:r===!0&&y===a.messages.length-1&&n.role==="assistant",streamContent:r===!0&&y===a.messages.length-1?l:void 0},n.id)),e.jsx("div",{ref:z})]}),c!==null&&e.jsxs("div",{style:{padding:"6px 12px",fontSize:11,color:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",borderTop:"1px solid rgba(255,107,107,0.2)",flexShrink:0},children:["âš "," ",c]}),e.jsxs("div",{style:{borderTop:`1px solid ${t.border}`,padding:8,flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"flex-end"},children:[e.jsx("textarea",{ref:A,value:k,onChange:n=>w(n.target.value),onKeyDown:T,placeholder:"Ask about your code...",rows:2,style:{flex:1,backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,borderRadius:6,padding:"6px 10px",fontSize:12,fontFamily:"inherit",resize:"none",outline:"none",lineHeight:1.4}}),r===!0?e.jsx("button",{onClick:N,title:"Cancel",style:{backgroundColor:"#ff6b6b",color:"#fff",border:"none",borderRadius:6,padding:"6px 12px",cursor:"pointer",fontSize:12,fontWeight:600,flexShrink:0,height:32},children:"â– "}):e.jsx("button",{onClick:C,disabled:u===!1,title:"Send (Enter)",style:{backgroundColor:u===!0?t.accent:t.bgHover,color:u===!0?t.accentText:t.textMuted,border:"none",borderRadius:6,padding:"6px 12px",cursor:u===!0?"pointer":"default",fontSize:12,fontWeight:600,flexShrink:0,height:32},children:"â†‘"})]}),e.jsxs("div",{style:{fontSize:10,color:t.textMuted,marginTop:4,textAlign:"center"},children:["Enter to send ","Â·"," Shift+Enter for new line"]})]})]})}const K=s.memo(function({message:i,theme:d,isStreaming:o,streamContent:r}){const l=i.role==="user",c=o===!0&&r!==void 0?r:i.content,f=s.useMemo(()=>V(c),[c]);return e.jsxs("div",{style:{padding:"8px 12px",marginBottom:4},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:600,color:l===!0?d.accent:d.textSecondary,marginBottom:4,textTransform:"uppercase",letterSpacing:.5},children:[l===!0?"You":"AI",o===!0&&e.jsx("span",{style:{fontWeight:400,marginLeft:6,color:d.textMuted},children:"typing..."})]}),e.jsx("div",{style:{fontSize:12,lineHeight:1.5,color:d.text,wordBreak:"break-word"},children:f.map((x,p)=>x.type==="code"?e.jsx(L,{code:x.content,language:x.language||"",theme:d},p):e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:x.content},p))})]})}),L=s.memo(function({code:i,language:d,theme:o}){const[r,l]=s.useState(!1),c=s.useCallback(()=>{navigator.clipboard.writeText(i),l(!0),setTimeout(()=>l(!1),H)},[i]),f=s.useCallback(()=>{if(O()!==null){const p=G();if(p!==null){const h=p.getSelection();h!==null&&p.executeEdits("ai-insert",[{range:h,text:i}])}}},[i]);return e.jsxs("div",{style:{margin:"8px 0",borderRadius:6,overflow:"hidden",border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 8px",backgroundColor:o.bgSecondary,borderBottom:`1px solid ${o.border}`},children:[e.jsx("span",{style:{fontSize:10,color:o.textMuted,textTransform:"uppercase"},children:d||"code"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:f,title:"Insert at cursor",style:{background:"none",border:`1px solid ${o.border}`,borderRadius:3,color:o.textMuted,cursor:"pointer",fontSize:10,padding:"2px 6px"},children:"Insert"}),e.jsx("button",{onClick:c,title:"Copy to clipboard",style:{background:"none",border:`1px solid ${o.border}`,borderRadius:3,color:r===!0?o.accent:o.textMuted,cursor:"pointer",fontSize:10,padding:"2px 6px"},children:r===!0?"Copied!":"Copy"})]})]}),e.jsx("pre",{style:{margin:0,padding:8,backgroundColor:o.bg,fontSize:11,fontFamily:"'SF Mono', 'Menlo', monospace",color:o.text,overflow:"auto",lineHeight:1.4,maxHeight:300},children:e.jsx("code",{children:i})})]})});function V(t){const i=[],d=/```(\w*)\n([\s\S]*?)```/g;let o=0,r;for(;(r=d.exec(t))!==null;){if(r.index>o){const l=t.substring(o,r.index);0<l.length&&i.push({type:"text",content:l})}i.push({type:"code",content:r[2].trim(),language:r[1]||void 0}),o=r.index+r[0].length}if(o<t.length){const l=t.substring(o);0<l.length&&i.push({type:"text",content:l})}return i.length===0&&0<t.length&&i.push({type:"text",content:t}),i}export{J as AIChatPanelViewPresenter};
