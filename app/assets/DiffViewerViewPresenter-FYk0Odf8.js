import{u as D,r as l,j as o,w as P,b as W}from"./index-BxO2YTdS.js";import{GetFileAtHead as E}from"./GitLogController-C6_nDoQD.js";import"./react-vendor-P8ZuH1e3.js";import"./monaco-editor-C1KnpKkb.js";function H(t){return l.useMemo(()=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:W,display:"flex",justifyContent:"center",alignItems:"center"},modal:{width:"90vw",height:"85vh",backgroundColor:t.bgSecondary,border:`1px solid ${t.border}`,borderRadius:8,boxShadow:"0 8px 32px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden"},header:{padding:"12px 16px",borderBottom:`1px solid ${t.border}`,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},headerTitle:{fontSize:14,fontWeight:600,color:t.text},modeToggleContainer:{display:"flex",gap:4},getModeButton:s=>({padding:"3px 10px",fontSize:11,borderRadius:4,cursor:"pointer",backgroundColor:s?t.accent:t.bg,color:s?t.accentText:t.text,border:`1px solid ${s?t.accent:t.border}`,fontWeight:s?600:400}),filesSelectContainer:{display:"flex",alignItems:"center",gap:8,flex:1},selectLabel:{fontSize:12,color:t.textSecondary},select:{flex:1,padding:"4px 8px",fontSize:12,backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,borderRadius:4},vsSeparator:{color:t.textSecondary},gitModeContainer:{display:"flex",alignItems:"center",gap:8,flex:1,fontSize:12,color:t.textSecondary},gitModeLabel:{color:t.textMuted},gitModeFileName:{color:t.text,fontWeight:600},gitModeFilePath:{color:t.textMuted,fontSize:10},sideByCheckboxLabel:{display:"flex",alignItems:"center",gap:4,fontSize:12,color:t.textSecondary,cursor:"pointer"},closeButton:{padding:"4px 12px",fontSize:12,backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,borderRadius:4,cursor:"pointer"},editorContainer:{flex:1,overflow:"hidden"}}),[t])}function V({theme:t}){var C,j,M;const{setShowDiffViewer:s,tabs:r,settings:c,activeTabId:f,isRepoInitialized:u}=D(),[d,k]=l.useState(u?"git":"files"),[x,m]=l.useState(((C=r[0])==null?void 0:C.id)||""),[p,v]=l.useState(((j=r[1])==null?void 0:j.id)||((M=r[0])==null?void 0:M.id)||""),[y,w]=l.useState(!0),[I,b]=l.useState(""),[h,z]=l.useState(""),a=l.useMemo(()=>r.find(e=>e.id===x),[r,x]),g=l.useMemo(()=>r.find(e=>e.id===p),[r,p]),n=l.useMemo(()=>r.find(e=>e.id===f),[r,f]);l.useEffect(()=>{if(d!=="git"||!(n!=null&&n.path))return;const e=n.path;z(e),E(e).then(R=>{b(R||"")}).catch(()=>{b("")})},[d,n==null?void 0:n.path]);const F=d==="git"?I:(a==null?void 0:a.content)||"",L=d==="git"?(n==null?void 0:n.content)||"":(g==null?void 0:g.content)||"",B=d==="git"?(n==null?void 0:n.language)||"plaintext":(a==null?void 0:a.language)||"plaintext",S=l.useCallback(()=>{s(!1)},[s]),i=H(t);return o.jsx("div",{style:i.overlay,onClick:S,children:o.jsxs("div",{style:i.modal,onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{style:i.header,children:[o.jsx("span",{style:i.headerTitle,children:"Compare Files"}),u&&o.jsx("div",{style:i.modeToggleContainer,children:["files","git"].map(e=>o.jsx("button",{onClick:()=>k(e),style:i.getModeButton(d===e),children:e==="files"?"Files":"Git HEAD"},e))}),d==="files"?o.jsxs("div",{style:i.filesSelectContainer,children:[o.jsx("label",{style:i.selectLabel,children:"Original:"}),o.jsx("select",{value:x,onChange:e=>m(e.target.value),style:i.select,children:r.map(e=>o.jsx("option",{value:e.id,children:e.name},e.id))}),o.jsx("span",{style:i.vsSeparator,children:"vs"}),o.jsx("label",{style:i.selectLabel,children:"Modified:"}),o.jsx("select",{value:p,onChange:e=>v(e.target.value),style:i.select,children:r.map(e=>o.jsx("option",{value:e.id,children:e.name},e.id))})]}):o.jsxs("div",{style:i.gitModeContainer,children:[o.jsx("span",{children:"HEAD"}),o.jsx("span",{style:i.gitModeLabel,children:"vs"}),o.jsx("span",{style:i.gitModeFileName,children:(n==null?void 0:n.name)||"No file"}),h&&o.jsxs("span",{style:i.gitModeFilePath,children:["(",h,")"]})]}),o.jsxs("label",{style:i.sideByCheckboxLabel,children:[o.jsx("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked)}),"Side by Side"]}),o.jsx("button",{onClick:S,style:i.closeButton,children:"Close"})]}),o.jsx("div",{style:i.editorContainer,children:o.jsx(P,{original:F,modified:L,language:B,theme:t.editorMonacoTheme,options:{readOnly:!0,renderSideBySide:y,fontSize:c.fontSize,fontFamily:c.fontFamily,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderOverviewRuler:!0,diffWordWrap:c.wordWrap?"on":"off"}})})]})})}export{V as DiffViewerViewPresenter};
