import{u as $,r as s,M as D,j as e,O as T,P as N,Q as P,V as W}from"./index-BTNi3_Rr.js";import"./react-vendor-P8ZuH1e3.js";import"./monaco-editor-BYMRfcD5.js";function L({theme:t}){var A;const{conversations:r,activeConversationId:d,isAiStreaming:n,aiStreamContent:i,aiOperationError:l,activeModelId:u,SetActiveConversation:p,RemoveConversation:c,SetAiOperationError:x,SetShowAiSettings:f,GetActiveProvider:M,GetCredentialForProvider:I}=$(),[j,v]=s.useState(""),[m,y]=s.useState(!1),k=s.useRef(null),w=s.useRef(null),a=r.find(o=>o.id===d)||null,b=M(),B=b!==null&&I(b.id)!==null,C=j.trim(),g=0<C.length;s.useEffect(()=>{var o;(o=k.current)==null||o.scrollIntoView({behavior:"smooth"})},[(A=a==null?void 0:a.messages)==null?void 0:A.length,i]);const S=s.useCallback(async()=>{if(!(!g||n===!0)){v(""),x(null);try{await D(C)}catch{}}},[C,g,n]),E=s.useCallback(o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),S())},[S]),R=s.useCallback(()=>{N()},[]),z=s.useCallback(()=>{var o;p(null),y(!1),(o=w.current)==null||o.focus()},[]);return B===!1?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:24,gap:12,height:"100%"},children:[e.jsx("div",{style:{fontSize:24},children:"âœ¨"}),e.jsx("div",{style:{color:t.text,fontSize:13,fontWeight:600,textAlign:"center"},children:"AI Assistant"}),e.jsx("div",{style:{color:t.textMuted,fontSize:12,textAlign:"center"},children:"Configure an API key to start using AI features."}),e.jsx("button",{onClick:()=>f(!0),style:{backgroundColor:t.accent,color:t.accentText,border:"none",borderRadius:6,padding:"8px 16px",cursor:"pointer",fontSize:12},children:"Open AI Settings"})]}):m===!0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${t.border}`},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600,color:t.text},children:"Conversations"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:z,title:"New Conversation",style:{background:"none",border:"none",color:t.accent,cursor:"pointer",fontSize:14,padding:"2px 6px"},children:"+"}),e.jsx("button",{onClick:()=>y(!1),title:"Back to Chat",style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:14,padding:"2px 6px"},children:"âœ•"})]})]}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:r.length===0?e.jsx("div",{style:{padding:16,color:t.textMuted,fontSize:12,textAlign:"center"},children:"No conversations yet"}):r.map(o=>e.jsxs("div",{onClick:()=>{p(o.id),y(!1)},style:{padding:"8px 12px",cursor:"pointer",borderBottom:`1px solid ${t.border}`,backgroundColor:o.id===d?t.bgActive:"transparent",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{overflow:"hidden",flex:1},children:[e.jsx("div",{style:{fontSize:12,color:t.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.title}),e.jsxs("div",{style:{fontSize:10,color:t.textMuted,marginTop:2},children:[o.messages.length," messages ","Â·"," ",new Date(o.createdAt).toLocaleDateString()]})]}),e.jsx("button",{onClick:h=>{h.stopPropagation(),c(o.id)},style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:12,padding:"2px 4px",flexShrink:0},children:"âœ•"})]},o.id))})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs("div",{style:{padding:"6px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${t.border}`,flexShrink:0},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:e.jsx("span",{style:{fontSize:12,fontWeight:600,color:t.text},children:a?a.title:"New Chat"})}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>y(!0),title:"Conversation History",style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:13,padding:"2px 6px"},children:"ðŸ“‹"}),e.jsx("button",{onClick:z,title:"New Conversation",style:{background:"none",border:"none",color:t.accent,cursor:"pointer",fontSize:13,padding:"2px 6px"},children:"+"}),e.jsx("button",{onClick:()=>f(!0),title:"AI Settings",style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:13,padding:"2px 6px"},children:"âš™"})]})]}),e.jsxs("div",{style:{padding:"4px 12px",fontSize:10,color:t.textMuted,borderBottom:`1px solid ${t.border}`,flexShrink:0},children:[(b==null?void 0:b.name)||"No provider"," ","Â·"," ",u]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"8px 0"},children:[a===null||a.messages.length===0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:24,gap:8},children:[e.jsx("div",{style:{fontSize:20},children:"âœ¨"}),e.jsx("div",{style:{color:t.textMuted,fontSize:12,textAlign:"center"},children:"Ask me anything about your code, or use the context menu on selected code for AI actions."})]}):a.messages.map((o,h)=>e.jsx(H,{message:o,theme:t,isStreaming:n===!0&&h===a.messages.length-1&&o.role==="assistant",streamContent:n===!0&&h===a.messages.length-1?i:void 0},o.id)),e.jsx("div",{ref:k})]}),l!==null&&e.jsxs("div",{style:{padding:"6px 12px",fontSize:11,color:"#ff6b6b",backgroundColor:"rgba(255,107,107,0.1)",borderTop:"1px solid rgba(255,107,107,0.2)",flexShrink:0},children:["âš "," ",l]}),e.jsxs("div",{style:{borderTop:`1px solid ${t.border}`,padding:8,flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"flex-end"},children:[e.jsx("textarea",{ref:w,value:j,onChange:o=>v(o.target.value),onKeyDown:E,placeholder:"Ask about your code...",rows:2,style:{flex:1,backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,borderRadius:6,padding:"6px 10px",fontSize:12,fontFamily:"inherit",resize:"none",outline:"none",lineHeight:1.4}}),n===!0?e.jsx("button",{onClick:R,title:"Cancel",style:{backgroundColor:"#ff6b6b",color:"#fff",border:"none",borderRadius:6,padding:"6px 12px",cursor:"pointer",fontSize:12,fontWeight:600,flexShrink:0,height:32},children:"â– "}):e.jsx("button",{onClick:S,disabled:g===!1,title:"Send (Enter)",style:{backgroundColor:g===!0?t.accent:t.bgHover,color:g===!0?t.accentText:t.textMuted,border:"none",borderRadius:6,padding:"6px 12px",cursor:g===!0?"pointer":"default",fontSize:12,fontWeight:600,flexShrink:0,height:32},children:"â†‘"})]}),e.jsxs("div",{style:{fontSize:10,color:t.textMuted,marginTop:4,textAlign:"center"},children:["Enter to send ","Â·"," Shift+Enter for new line"]})]})]})}const H=s.memo(function({message:r,theme:d,isStreaming:n,streamContent:i}){const l=r.role==="user",u=n===!0&&i!==void 0?i:r.content,p=s.useMemo(()=>F(u),[u]);return e.jsxs("div",{style:{padding:"8px 12px",marginBottom:4},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:600,color:l===!0?d.accent:d.textSecondary,marginBottom:4,textTransform:"uppercase",letterSpacing:.5},children:[l===!0?"You":"AI",n===!0&&e.jsx("span",{style:{fontWeight:400,marginLeft:6,color:d.textMuted},children:"typing..."})]}),e.jsx("div",{style:{fontSize:12,lineHeight:1.5,color:d.text,wordBreak:"break-word"},children:p.map((c,x)=>c.type==="code"?e.jsx(O,{code:c.content,language:c.language||"",theme:d},`code-${x}-${c.language}`):e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:c.content},`text-${x}-${c.content.substring(0,20)}`))})]})}),O=s.memo(function({code:r,language:d,theme:n}){const[i,l]=s.useState(!1),u=s.useCallback(()=>{navigator.clipboard.writeText(r),l(!0),setTimeout(()=>l(!1),T)},[r]),p=s.useCallback(()=>{if(P()!==null){const x=W();if(x!==null){const f=x.getSelection();f!==null&&x.executeEdits("ai-insert",[{range:f,text:r}])}}},[r]);return e.jsxs("div",{style:{margin:"8px 0",borderRadius:6,overflow:"hidden",border:`1px solid ${n.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 8px",backgroundColor:n.bgSecondary,borderBottom:`1px solid ${n.border}`},children:[e.jsx("span",{style:{fontSize:10,color:n.textMuted,textTransform:"uppercase"},children:d||"code"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:p,title:"Insert at cursor",style:{background:"none",border:`1px solid ${n.border}`,borderRadius:3,color:n.textMuted,cursor:"pointer",fontSize:10,padding:"2px 6px"},children:"Insert"}),e.jsx("button",{onClick:u,title:"Copy to clipboard",style:{background:"none",border:`1px solid ${n.border}`,borderRadius:3,color:i===!0?n.accent:n.textMuted,cursor:"pointer",fontSize:10,padding:"2px 6px"},children:i===!0?"Copied!":"Copy"})]})]}),e.jsx("pre",{style:{margin:0,padding:8,backgroundColor:n.bg,fontSize:11,fontFamily:"'SF Mono', 'Menlo', monospace",color:n.text,overflow:"auto",lineHeight:1.4,maxHeight:300},children:e.jsx("code",{children:r})})]})});function F(t){const r=[],d=/```(\w*)\n([\s\S]*?)```/g;let n=0,i;for(;(i=d.exec(t))!==null;){if(i.index>n){const l=t.substring(n,i.index);0<l.length&&r.push({type:"text",content:l})}r.push({type:"code",content:i[2].trim(),language:i[1]||void 0}),n=i.index+i[0].length}if(n<t.length){const l=t.substring(n);0<l.length&&r.push({type:"text",content:l})}return r.length===0&&0<t.length&&r.push({type:"text",content:t}),r}export{L as AIChatPanelViewPresenter};
