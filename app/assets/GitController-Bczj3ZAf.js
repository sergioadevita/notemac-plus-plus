import{g as E,i as L}from"./index-DlyQSLxP.js";import{x as At,D,N as G,u as Nt,G as qt}from"./index-CoP6w3tT.js";import{c as dt,b as zt,g as Lt}from"./react-vendor-P8ZuH1e3.js";var W,ft;function jt(){if(ft)return W;ft=1,W=r;function r(t){var n,o;if(typeof t!="function")throw new Error("expected a function but got "+t);return function(){return n||(n=!0,o=t.apply(this,arguments)),o}}return W}var X={},mt;function Ht(){return mt||(mt=1,(function(r){function t(h,d){var y;return h instanceof Buffer?y=h:y=Buffer.from(h.buffer,h.byteOffset,h.byteLength),y.toString(d)}var n=function(h){return Buffer.from(h)};function o(h){for(var d=0,y=Math.min(256*256,h.length+1),k=new Uint16Array(y),F=[],v=0;;){var b=d<h.length;if(!b||v>=y-1){var N=k.subarray(0,v),q=N;if(F.push(String.fromCharCode.apply(null,q)),!b)return F.join("");h=h.subarray(d),d=0,v=0}var I=h[d++];if((I&128)===0)k[v++]=I;else if((I&224)===192){var C=h[d++]&63;k[v++]=(I&31)<<6|C}else if((I&240)===224){var C=h[d++]&63,$=h[d++]&63;k[v++]=(I&31)<<12|C<<6|$}else if((I&248)===240){var C=h[d++]&63,$=h[d++]&63,Ct=h[d++]&63,M=(I&7)<<18|C<<12|$<<6|Ct;M>65535&&(M-=65536,k[v++]=M>>>10&1023|55296,M=56320|M&1023),k[v++]=M}}}function s(h){for(var d=0,y=h.length,k=0,F=Math.max(32,y+(y>>>1)+7),v=new Uint8Array(F>>>3<<3);d<y;){var b=h.charCodeAt(d++);if(b>=55296&&b<=56319){if(d<y){var N=h.charCodeAt(d);(N&64512)===56320&&(++d,b=((b&1023)<<10)+(N&1023)+65536)}if(b>=55296&&b<=56319)continue}if(k+4>v.length){F+=8,F*=1+d/h.length*2,F=F>>>3<<3;var q=new Uint8Array(F);q.set(v),v=q}if((b&4294967168)===0){v[k++]=b;continue}else if((b&4294965248)===0)v[k++]=b>>>6&31|192;else if((b&4294901760)===0)v[k++]=b>>>12&15|224,v[k++]=b>>>6&63|128;else if((b&4292870144)===0)v[k++]=b>>>18&7|240,v[k++]=b>>>12&63|128,v[k++]=b>>>6&63|128;else continue;v[k++]=b&63|128}return v.slice?v.slice(0,k):v.subarray(0,k)}var c="Failed to ",a=function(h,d,y){if(h)throw new Error("".concat(c).concat(d,": the '").concat(y,"' option is unsupported."))},i=typeof Buffer=="function"&&Buffer.from,e=i?n:s;function l(){this.encoding="utf-8"}l.prototype.encode=function(h,d){return a(d&&d.stream,"encode","stream"),e(h)};function m(h){var d;try{var y=new Blob([h],{type:"text/plain;charset=UTF-8"});d=URL.createObjectURL(y);var k=new XMLHttpRequest;return k.open("GET",d,!1),k.send(),k.responseText}finally{d&&URL.revokeObjectURL(d)}}var w=!i&&typeof Blob=="function"&&typeof URL=="function"&&typeof URL.createObjectURL=="function",g=["utf-8","utf8","unicode-1-1-utf-8"],u=o;i?u=t:w&&(u=function(h){try{return m(h)}catch{return o(h)}});var f="construct 'TextDecoder'",p="".concat(c," ").concat(f,": the ");function _(h,d){a(d&&d.fatal,f,"fatal"),h=h||"utf-8";var y;if(i?y=Buffer.isEncoding(h):y=g.indexOf(h.toLowerCase())!==-1,!y)throw new RangeError("".concat(p," encoding label provided ('").concat(h,"') is invalid."));this.encoding=h,this.fatal=!1,this.ignoreBOM=!1}_.prototype.decode=function(h,d){a(d&&d.stream,"decode","stream");var y;return h instanceof Uint8Array?y=h:h.buffer instanceof ArrayBuffer?y=new Uint8Array(h.buffer):y=new Uint8Array(h),u(y,this.encoding)},r.TextEncoder=r.TextEncoder||l,r.TextDecoder=r.TextDecoder||_})(typeof window<"u"?window:typeof dt<"u"?dt:X)),X}var Y,wt;function Ut(){return wt||(wt=1,Ht(),Y={encode:r=>new TextEncoder().encode(r),decode:r=>new TextDecoder().decode(r)}),Y}var J,_t;function $t(){if(_t)return J;_t=1,J=r;function r(t,n,o){var s;return function(){if(!n)return t.apply(this,arguments);var c=this,a=arguments,i=o&&!s;if(clearTimeout(s),s=setTimeout(function(){if(s=null,!i)return t.apply(c,a)},n),i)return t.apply(this,arguments)}}return J}var K,pt;function lt(){if(pt)return K;pt=1;function r(i){if(i.length===0)return".";let e=o(i);return e=e.reduce(a,[]),n(...e)}function t(...i){let e="";for(let l of i)l.startsWith("/")?e=l:e=r(n(e,l));return e}function n(...i){if(i.length===0)return"";let e=i.join("/");return e=e.replace(/\/{2,}/g,"/"),e}function o(i){if(i.length===0)return[];if(i==="/")return["/"];let e=i.split("/");return e[e.length-1]===""&&e.pop(),i[0]==="/"?e[0]="/":e[0]!=="."&&e.unshift("."),e}function s(i){const e=i.lastIndexOf("/");if(e===-1)throw new Error(`Cannot get dirname of "${i}"`);return e===0?"/":i.slice(0,e)}function c(i){if(i==="/")throw new Error(`Cannot get basename of "${i}"`);const e=i.lastIndexOf("/");return e===-1?i:i.slice(e+1)}function a(i,e){if(i.length===0)return i.push(e),i;if(e===".")return i;if(e===".."){if(i.length===1){if(i[0]==="/")throw new Error("Unable to normalize path - traverses above root directory");if(i[0]===".")return i.push(e),i}return i[i.length-1]===".."?(i.push(".."),i):(i.pop(),i)}return i.push(e),i}return K={join:n,normalize:r,split:o,basename:c,dirname:s,resolve:t},K}var V,yt;function Tt(){if(yt)return V;yt=1;function r(i){return class extends Error{constructor(...e){super(...e),this.code=i,this.message?this.message=i+": "+this.message:this.message=i}}}const t=r("EEXIST"),n=r("ENOENT"),o=r("ENOTDIR"),s=r("ENOTEMPTY"),c=r("ETIMEDOUT"),a=r("EISDIR");return V={EEXIST:t,ENOENT:n,ENOTDIR:o,ENOTEMPTY:s,ETIMEDOUT:c,EISDIR:a},V}var Q,gt;function Wt(){if(gt)return Q;gt=1;const r=lt(),{EEXIST:t,ENOENT:n,ENOTDIR:o,ENOTEMPTY:s,EISDIR:c}=Tt(),a=0;return Q=class{constructor(){}_makeRoot(e=new Map){return e.set(a,{mode:511,type:"dir",size:0,ino:0,mtimeMs:Date.now()}),e}activate(e=null){e===null?this._root=new Map([["/",this._makeRoot()]]):typeof e=="string"?this._root=new Map([["/",this._makeRoot(this.parse(e))]]):this._root=e}get activated(){return!!this._root}deactivate(){this._root=void 0}size(){return this._countInodes(this._root.get("/"))-1}_countInodes(e){let l=1;for(let[m,w]of e)m!==a&&(l+=this._countInodes(w));return l}autoinc(){return this._maxInode(this._root.get("/"))+1}_maxInode(e){let l=e.get(a).ino;for(let[m,w]of e)m!==a&&(l=Math.max(l,this._maxInode(w)));return l}print(e=this._root.get("/")){let l="";const m=(w,g)=>{for(let[u,f]of w){if(u===0)continue;let p=f.get(a),_=p.mode.toString(8);l+=`${"	".repeat(g)}${u}	${_}`,p.type==="file"?l+=`	${p.size}	${p.mtimeMs}
`:(l+=`
`,m(f,g+1))}};return m(e,0),l}parse(e){let l=0;function m(f){const p=++l,_=f.length===1?"dir":"file";let[h,d,y]=f;return h=parseInt(h,8),d=d?parseInt(d):0,y=y?parseInt(y):Date.now(),new Map([[a,{mode:h,type:_,size:d,mtimeMs:y,ino:p}]])}let w=e.trim().split(`
`),g=this._makeRoot(),u=[{indent:-1,node:g},{indent:0,node:null}];for(let f of w){let _=f.match(/^\t*/)[0].length;f=f.slice(_);let[h,...d]=f.split("	"),y=m(d);if(_<=u[u.length-1].indent)for(;_<=u[u.length-1].indent;)u.pop();u.push({indent:_,node:y}),u[u.length-2].node.set(h,y)}return g}_lookup(e,l=!0){let m=this._root,w="/",g=r.split(e);for(let u=0;u<g.length;++u){let f=g[u];if(m=m.get(f),!m)throw new n(e);if(l||u<g.length-1){const p=m.get(a);if(p.type==="symlink"){let _=r.resolve(w,p.target);m=this._lookup(_)}w?w=r.join(w,f):w=f}}return m}mkdir(e,{mode:l}){if(e==="/")throw new t;let m=this._lookup(r.dirname(e)),w=r.basename(e);if(m.has(w))throw new t;let g=new Map,u={mode:l,type:"dir",size:0,mtimeMs:Date.now(),ino:this.autoinc()};g.set(a,u),m.set(w,g)}rmdir(e){let l=this._lookup(e);if(l.get(a).type!=="dir")throw new o;if(l.size>1)throw new s;let m=this._lookup(r.dirname(e)),w=r.basename(e);m.delete(w)}readdir(e){let l=this._lookup(e);if(l.get(a).type!=="dir")throw new o;return[...l.keys()].filter(m=>typeof m=="string")}writeStat(e,l,{mode:m}){let w,g;try{g=this.stat(e)}catch{}if(g!==void 0){if(g.type==="dir")throw new c;m==null&&(m=g.mode),w=g.ino}m==null&&(m=438),w==null&&(w=this.autoinc());let u=this._lookup(r.dirname(e)),f=r.basename(e),p={mode:m,type:"file",size:l,mtimeMs:Date.now(),ino:w},_=new Map;return _.set(a,p),u.set(f,_),p}unlink(e){let l=this._lookup(r.dirname(e)),m=r.basename(e);l.delete(m)}rename(e,l){let m=r.basename(l),w=this._lookup(e);this._lookup(r.dirname(l)).set(m,w),this.unlink(e)}stat(e){return this._lookup(e).get(a)}lstat(e){return this._lookup(e,!1).get(a)}readlink(e){return this._lookup(e,!1).get(a).target}symlink(e,l){let m,w;try{let _=this.stat(l);w===null&&(w=_.mode),m=_.ino}catch{}w==null&&(w=40960),m==null&&(m=this.autoinc());let g=this._lookup(r.dirname(l)),u=r.basename(l),f={mode:w,type:"symlink",target:e,size:0,mtimeMs:Date.now(),ino:m},p=new Map;return p.set(a,f),g.set(u,p),f}_du(e){let l=0;for(const[m,w]of e.entries())m===a?l+=w.size:l+=this._du(w);return l}du(e){let l=this._lookup(e);return this._du(l)}},Q}class It{constructor(t="keyval-store",n="keyval"){this.storeName=n,this._dbName=t,this._storeName=n,this._init()}_init(){this._dbp||(this._dbp=new Promise((t,n)=>{const o=indexedDB.open(this._dbName);o.onerror=()=>n(o.error),o.onsuccess=()=>t(o.result),o.onupgradeneeded=()=>{o.result.createObjectStore(this._storeName)}}))}_withIDBStore(t,n){return this._init(),this._dbp.then(o=>new Promise((s,c)=>{const a=o.transaction(this.storeName,t);a.oncomplete=()=>s(),a.onabort=a.onerror=()=>c(a.error),n(a.objectStore(this.storeName))}))}_close(){return this._init(),this._dbp.then(t=>{t.close(),this._dbp=void 0})}}let Z;function R(){return Z||(Z=new It),Z}function Xt(r,t=R()){let n;return t._withIDBStore("readwrite",o=>{n=o.get(r)}).then(()=>n.result)}function Yt(r,t,n=R()){return n._withIDBStore("readwrite",o=>{o.put(t,r)})}function Jt(r,t,n=R()){return n._withIDBStore("readwrite",o=>{const s=o.get(r);s.onsuccess=()=>{o.put(t(s.result),r)}})}function Kt(r,t=R()){return t._withIDBStore("readwrite",n=>{n.delete(r)})}function Vt(r=R()){return r._withIDBStore("readwrite",t=>{t.clear()})}function Qt(r=R()){const t=[];return r._withIDBStore("readwrite",n=>{(n.openKeyCursor||n.openCursor).call(n).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}function Zt(r=R()){return r._close()}const te=Object.freeze(Object.defineProperty({__proto__:null,Store:It,clear:Vt,close:Zt,del:Kt,get:Xt,keys:Qt,set:Yt,update:Jt},Symbol.toStringTag,{value:"Module"})),Dt=zt(te);var tt,kt;function ee(){if(kt)return tt;kt=1;const r=Dt;return tt=class{constructor(n,o){this._database=n,this._storename=o,this._store=new r.Store(this._database,this._storename)}saveSuperblock(n){return r.set("!root",n,this._store)}loadSuperblock(){return r.get("!root",this._store)}readFile(n){return r.get(n,this._store)}writeFile(n,o){return r.set(n,o,this._store)}unlink(n){return r.del(n,this._store)}wipe(){return r.clear(this._store)}close(){return r.close(this._store)}},tt}var et,vt;function ie(){return vt||(vt=1,et=class{constructor(t){this._url=t}loadSuperblock(){return fetch(this._url+"/.superblock.txt").then(t=>t.ok?t.text():null)}async readFile(t){const n=await fetch(this._url+t);if(n.status===200)return n.arrayBuffer();throw new Error("ENOENT")}async sizeFile(t){const n=await fetch(this._url+t,{method:"HEAD"});if(n.status===200)return n.headers.get("content-length");throw new Error("ENOENT")}}),et}var it,St;function re(){if(St)return it;St=1;const r=Dt,t=n=>new Promise(o=>setTimeout(o,n));return it=class{constructor(o,s){this._id=Math.random(),this._database=o,this._storename=s,this._store=new r.Store(this._database,this._storename),this._lock=null}async has({margin:o=2e3}={}){if(this._lock&&this._lock.holder===this._id){const s=Date.now();return this._lock.expires>s+o?!0:await this.renew()}else return!1}async renew({ttl:o=5e3}={}){let s;return await r.update("lock",c=>{const i=Date.now()+o;return s=c&&c.holder===this._id,this._lock=s?{holder:this._id,expires:i}:c,this._lock},this._store),s}async acquire({ttl:o=5e3}={}){let s,c,a;if(await r.update("lock",i=>{const e=Date.now(),l=e+o;return c=i&&i.expires<e,s=i===void 0||c,a=i&&i.holder===this._id,this._lock=s?{holder:this._id,expires:l}:i,this._lock},this._store),a)throw new Error("Mutex double-locked");return s}async wait({interval:o=100,limit:s=6e3,ttl:c}={}){for(;s--;){if(await this.acquire({ttl:c}))return!0;await t(o)}throw new Error("Mutex timeout")}async release({force:o=!1}={}){let s,c,a;if(await r.update("lock",i=>(s=o||i&&i.holder===this._id,c=i===void 0,a=i&&i.holder!==this._id,this._lock=s?void 0:i,this._lock),this._store),await r.close(this._store),!s&&!o){if(c)throw new Error("Mutex double-freed");if(a)throw new Error("Mutex lost ownership")}return s}},it}var rt,bt;function ne(){return bt||(bt=1,rt=class{constructor(t){this._id=Math.random(),this._database=t,this._has=!1,this._release=null}async has(){return this._has}async acquire(){return new Promise(t=>{navigator.locks.request(this._database+"_lock",{ifAvailable:!0},n=>(this._has=!!n,t(!!n),new Promise(o=>{this._release=o})))})}async wait({timeout:t=6e5}={}){return new Promise((n,o)=>{const s=new AbortController;setTimeout(()=>{s.abort(),o(new Error("Mutex timeout"))},t),navigator.locks.request(this._database+"_lock",{signal:s.signal},c=>(this._has=!!c,n(!!c),new Promise(a=>{this._release=a})))})}async release({force:t=!1}={}){this._has=!1,this._release?this._release():t&&navigator.locks.request(this._database+"_lock",{steal:!0},n=>!0)}}),rt}var nt,Et;function se(){if(Et)return nt;Et=1;const{encode:r,decode:t}=Ut(),n=$t(),o=Wt(),{ENOENT:s,ENOTEMPTY:c,ETIMEDOUT:a}=Tt(),i=ee(),e=ie(),l=re(),m=ne(),w=lt();return nt=class{constructor(){this.saveSuperblock=n(()=>{this.flush()},500)}async init(u,{wipe:f,url:p,urlauto:_,fileDbName:h=u,db:d=null,fileStoreName:y=u+"_files",lockDbName:k=u+"_lock",lockStoreName:F=u+"_lock"}={}){this._name=u,this._idb=d||new i(h,y),this._mutex=navigator.locks?new m(u):new l(k,F),this._cache=new o(u),this._opts={wipe:f,url:p},this._needsWipe=!!f,p&&(this._http=new e(p),this._urlauto=!!_)}async activate(){if(this._cache.activated)return;this._needsWipe&&(this._needsWipe=!1,await this._idb.wipe(),await this._mutex.release({force:!0})),await this._mutex.has()||await this._mutex.wait();const u=await this._idb.loadSuperblock();if(u)this._cache.activate(u);else if(this._http){const f=await this._http.loadSuperblock();this._cache.activate(f),await this._saveSuperblock()}else this._cache.activate();if(!await this._mutex.has())throw new a}async deactivate(){await this._mutex.has()&&await this._saveSuperblock(),this._cache.deactivate();try{await this._mutex.release()}catch{}await this._idb.close()}async _saveSuperblock(){this._cache.activated&&(this._lastSavedAt=Date.now(),await this._idb.saveSuperblock(this._cache._root))}_writeStat(u,f,p){let _=w.split(w.dirname(u)),h=_.shift();for(let d of _){h=w.join(h,d);try{this._cache.mkdir(h,{mode:511})}catch{}}return this._cache.writeStat(u,f,p)}async readFile(u,f){const p=typeof f=="string"?f:f&&f.encoding;if(p&&p!=="utf8")throw new Error('Only "utf8" encoding is supported in readFile');let _=null,h=null;try{h=this._cache.stat(u),_=await this._idb.readFile(h.ino)}catch(d){if(!this._urlauto)throw d}if(!_&&this._http){let d=this._cache.lstat(u);for(;d.type==="symlink";)u=w.resolve(w.dirname(u),d.target),d=this._cache.lstat(u);_=await this._http.readFile(u)}if(_&&((!h||h.size!=_.byteLength)&&(h=await this._writeStat(u,_.byteLength,{mode:h?h.mode:438}),this.saveSuperblock()),p==="utf8"?_=t(_):_.toString=()=>t(_)),!h)throw new s(u);return _}async writeFile(u,f,p){const{mode:_,encoding:h="utf8"}=p;if(typeof f=="string"){if(h!=="utf8")throw new Error('Only "utf8" encoding is supported in writeFile');f=r(f)}const d=await this._cache.writeStat(u,f.byteLength,{mode:_});await this._idb.writeFile(d.ino,f)}async unlink(u,f){const p=this._cache.lstat(u);this._cache.unlink(u),p.type!=="symlink"&&await this._idb.unlink(p.ino)}readdir(u,f){return this._cache.readdir(u)}mkdir(u,f){const{mode:p=511}=f;this._cache.mkdir(u,{mode:p})}rmdir(u,f){if(u==="/")throw new c;this._cache.rmdir(u)}rename(u,f){this._cache.rename(u,f)}stat(u,f){return this._cache.stat(u)}lstat(u,f){return this._cache.lstat(u)}readlink(u,f){return this._cache.readlink(u)}symlink(u,f){this._cache.symlink(u,f)}async backFile(u,f){let p=await this._http.sizeFile(u);await this._writeStat(u,p,f)}du(u){return this._cache.du(u)}flush(){return this._saveSuperblock()}},nt}var st,Ot;function ae(){return Ot||(Ot=1,st=class{constructor(t){this.type=t.type,this.mode=t.mode,this.size=t.size,this.ino=t.ino,this.mtimeMs=t.mtimeMs,this.ctimeMs=t.ctimeMs||t.mtimeMs,this.uid=1,this.gid=1,this.dev=1}isFile(){return this.type==="file"}isDirectory(){return this.type==="dir"}isSymbolicLink(){return this.type==="symlink"}}),st}var at,Pt;function oe(){if(Pt)return at;Pt=1;const r=se(),t=ae(),n=lt();function o(a,i,...e){return a=n.normalize(a),(typeof i>"u"||typeof i=="function")&&(i={}),typeof i=="string"&&(i={encoding:i}),[a,i,...e]}function s(a,i,e,...l){return a=n.normalize(a),(typeof e>"u"||typeof e=="function")&&(e={}),typeof e=="string"&&(e={encoding:e}),[a,i,e,...l]}function c(a,i,...e){return[n.normalize(a),n.normalize(i),...e]}return at=class{constructor(i,e={}){this.init=this.init.bind(this),this.readFile=this._wrap(this.readFile,o,!1),this.writeFile=this._wrap(this.writeFile,s,!0),this.unlink=this._wrap(this.unlink,o,!0),this.readdir=this._wrap(this.readdir,o,!1),this.mkdir=this._wrap(this.mkdir,o,!0),this.rmdir=this._wrap(this.rmdir,o,!0),this.rename=this._wrap(this.rename,c,!0),this.stat=this._wrap(this.stat,o,!1),this.lstat=this._wrap(this.lstat,o,!1),this.readlink=this._wrap(this.readlink,o,!1),this.symlink=this._wrap(this.symlink,c,!0),this.backFile=this._wrap(this.backFile,o,!0),this.du=this._wrap(this.du,o,!1),this._deactivationPromise=null,this._deactivationTimeout=null,this._activationPromise=null,this._operations=new Set,i&&this.init(i,e)}async init(...i){return this._initPromiseResolve&&await this._initPromise,this._initPromise=this._init(...i),this._initPromise}async _init(i,e={}){await this._gracefulShutdown(),this._activationPromise&&await this._deactivate(),this._backend&&this._backend.destroy&&await this._backend.destroy(),this._backend=e.backend||new r,this._backend.init&&await this._backend.init(i,e),this._initPromiseResolve&&(this._initPromiseResolve(),this._initPromiseResolve=null),e.defer||this.stat("/")}async _gracefulShutdown(){this._operations.size>0&&(this._isShuttingDown=!0,await new Promise(i=>this._gracefulShutdownResolve=i),this._isShuttingDown=!1,this._gracefulShutdownResolve=null)}_wrap(i,e,l){return async(...m)=>{m=e(...m);let w={name:i.name,args:m};this._operations.add(w);try{return await this._activate(),await i.apply(this,m)}finally{this._operations.delete(w),l&&this._backend.saveSuperblock(),this._operations.size===0&&(this._deactivationTimeout||clearTimeout(this._deactivationTimeout),this._deactivationTimeout=setTimeout(this._deactivate.bind(this),500))}}}async _activate(){this._initPromise,await this._initPromise,this._deactivationTimeout&&(clearTimeout(this._deactivationTimeout),this._deactivationTimeout=null),this._deactivationPromise&&await this._deactivationPromise,this._deactivationPromise=null,this._activationPromise||(this._activationPromise=this._backend.activate?this._backend.activate():Promise.resolve()),await this._activationPromise}async _deactivate(){return this._activationPromise&&await this._activationPromise,this._deactivationPromise||(this._deactivationPromise=this._backend.deactivate?this._backend.deactivate():Promise.resolve()),this._activationPromise=null,this._gracefulShutdownResolve&&this._gracefulShutdownResolve(),this._deactivationPromise}async readFile(i,e){return this._backend.readFile(i,e)}async writeFile(i,e,l){return await this._backend.writeFile(i,e,l),null}async unlink(i,e){return await this._backend.unlink(i,e),null}async readdir(i,e){return this._backend.readdir(i,e)}async mkdir(i,e){return await this._backend.mkdir(i,e),null}async rmdir(i,e){return await this._backend.rmdir(i,e),null}async rename(i,e){return await this._backend.rename(i,e),null}async stat(i,e){const l=await this._backend.stat(i,e);return new t(l)}async lstat(i,e){const l=await this._backend.lstat(i,e);return new t(l)}async readlink(i,e){return this._backend.readlink(i,e)}async symlink(i,e){return await this._backend.symlink(i,e),null}async backFile(i,e){return await this._backend.backFile(i,e),null}async du(i){return this._backend.du(i)}async flush(){return this._backend.flush()}},at}var ot,Ft;function ce(){if(Ft)return ot;Ft=1;const r=jt(),t=oe();function n(o,s){return typeof o=="function"&&(s=o),s=r(s),[(...a)=>s(null,...a),s]}return ot=class{constructor(...s){this.promises=new t(...s),this.init=this.init.bind(this),this.readFile=this.readFile.bind(this),this.writeFile=this.writeFile.bind(this),this.unlink=this.unlink.bind(this),this.readdir=this.readdir.bind(this),this.mkdir=this.mkdir.bind(this),this.rmdir=this.rmdir.bind(this),this.rename=this.rename.bind(this),this.stat=this.stat.bind(this),this.lstat=this.lstat.bind(this),this.readlink=this.readlink.bind(this),this.symlink=this.symlink.bind(this),this.backFile=this.backFile.bind(this),this.du=this.du.bind(this),this.flush=this.flush.bind(this)}init(s,c){return this.promises.init(s,c)}readFile(s,c,a){const[i,e]=n(c,a);this.promises.readFile(s,c).then(i).catch(e)}writeFile(s,c,a,i){const[e,l]=n(a,i);this.promises.writeFile(s,c,a).then(e).catch(l)}unlink(s,c,a){const[i,e]=n(c,a);this.promises.unlink(s,c).then(i).catch(e)}readdir(s,c,a){const[i,e]=n(c,a);this.promises.readdir(s,c).then(i).catch(e)}mkdir(s,c,a){const[i,e]=n(c,a);this.promises.mkdir(s,c).then(i).catch(e)}rmdir(s,c,a){const[i,e]=n(c,a);this.promises.rmdir(s,c).then(i).catch(e)}rename(s,c,a){const[i,e]=n(a);this.promises.rename(s,c).then(i).catch(e)}stat(s,c,a){const[i,e]=n(c,a);this.promises.stat(s).then(i).catch(e)}lstat(s,c,a){const[i,e]=n(c,a);this.promises.lstat(s).then(i).catch(e)}readlink(s,c,a){const[i,e]=n(c,a);this.promises.readlink(s).then(i).catch(e)}symlink(s,c,a){const[i,e]=n(a);this.promises.symlink(s,c).then(i).catch(e)}backFile(s,c,a){const[i,e]=n(c,a);this.promises.backFile(s,c).then(i).catch(e)}du(s,c){const[a,i]=n(c);this.promises.du(s).then(a).catch(i)}flush(s){const[c,a]=n(s);this.promises.flush().then(c).catch(a)}},ot}var le=ce();const ue=Lt(le);function B(){return typeof window!==null&&window.electronAPI?"electron":"showDirectoryPicker"in window?"webfs":"lightningfs"}function he(){return B()==="electron"}function de(){return B()==="webfs"}function fe(){return B()==="lightningfs"}const z=new Map;function Gt(r){return z.has(r)||z.set(r,new ue(r)),z.get(r)}function me(r){z.delete(r),"indexedDB"in window&&window.indexedDB.deleteDatabase(r)}function ut(r){return Gt(r).promises}const xt=new Map;function we(r,t){xt.set(r,t)}function Rt(r){return xt.get(r)}function Bt(r){async function t(s){const c=s.split("/").filter(e=>0<e.length);if(c.length===0)return{dir:r,name:""};const a=c.pop();let i=r;for(const e of c)i=await i.getDirectoryHandle(e,{create:!1});return{dir:i,name:a}}async function n(s){const c=s.split("/").filter(i=>0<i.length);let a=r;for(const i of c)a=await a.getDirectoryHandle(i,{create:!1});return a}const o={readFile:async(s,c)=>{const{dir:a,name:i}=await t(s),l=await(await a.getFileHandle(i)).getFile();return c&&c.encoding==="utf8"?await l.text():new Uint8Array(await l.arrayBuffer())},writeFile:async(s,c,a)=>{const i=s.split("/").filter(g=>0<g.length),e=i.pop();let l=r;for(const g of i)l=await l.getDirectoryHandle(g,{create:!0});const w=await(await l.getFileHandle(e,{create:!0})).createWritable();await w.write(c),await w.close()},unlink:async s=>{const{dir:c,name:a}=await t(s);await c.removeEntry(a)},readdir:async s=>{const c=s.length===0||s==="/"||s==="."?r:await n(s),a=[];for await(const i of c.values())a.push(i.name);return a},mkdir:async s=>{const c=s.split("/").filter(i=>0<i.length);let a=r;for(const i of c)a=await a.getDirectoryHandle(i,{create:!0})},rmdir:async s=>{const{dir:c,name:a}=await t(s);await c.removeEntry(a,{recursive:!0})},stat:async s=>{if(s.length===0||s==="/"||s===".")return{isFile:()=>!1,isDirectory:()=>!0,isSymbolicLink:()=>!1,size:0,mode:16877,mtimeMs:Date.now()};try{const c=await n(s);return{isFile:()=>!1,isDirectory:()=>!0,isSymbolicLink:()=>!1,size:0,mode:16877,mtimeMs:Date.now()}}catch{const{dir:c,name:a}=await t(s),e=await(await c.getFileHandle(a)).getFile();return{isFile:()=>!0,isDirectory:()=>!1,isSymbolicLink:()=>!1,size:e.size,mode:33188,mtimeMs:e.lastModified}}},lstat:async s=>o.stat(s)};return o}function Mt(r,t){const n=B();return n==="electron"?null:n==="webfs"&&t?Bt(t):ut(r)}const xe=Object.freeze(Object.defineProperty({__proto__:null,CreateLightningFsAdapter:ut,CreateWebFsAdapter:Bt,DeleteLightningFs:me,DetectFsBackend:B,GetDirHandle:Rt,GetFsForGit:Mt,GetLightningFs:Gt,IsBrowserWorkspaceEnvironment:fe,IsElectronEnvironment:he,IsWebFsEnvironment:de,RegisterDirHandle:we},Symbol.toStringTag,{value:"Module"}));function S(){return Nt.getState()}let x,A=null,ct=null;function O(){const t=S().workspacePath||"";if(x!==void 0&&t===ct)return x;ct=t;const n=B();if(n==="electron")return x=null,null;if(n==="webfs"){const o=Rt(t);if(o)return x=Mt(t,o),x}return x=ut(t||"notemac-default"),x}function j(){return S().gitSettings.corsProxy||qt}function H(r){const t=r||S().gitCredentials;if(t!=null)return()=>({username:t.username||t.token||"",password:t.token||""})}function P(){const r=S().workspacePath||"";return A!==null&&r===ct?A:B()==="webfs"?(A="/","/"):(A=r||"/",A)}function _e(r){const t=[],n=[],o=[],s=r.length;for(let c=0;c<s;c++){const[a,i,e,l]=r[c];if(i===0&&e===2&&l===0){o.push({path:a,status:"untracked",isStaged:!1});continue}if(i===0&&e===2&&l===2){t.push({path:a,status:"added",isStaged:!0});continue}if(i===0&&e===0&&l===2){t.push({path:a,status:"added",isStaged:!0});continue}if(i===1&&e===2&&l===2){t.push({path:a,status:"modified",isStaged:!0});continue}if(i===1&&e===2&&l===3){t.push({path:a,status:"modified",isStaged:!0}),n.push({path:a,status:"modified",isStaged:!1});continue}if(i===1&&e===2&&l===1){n.push({path:a,status:"modified",isStaged:!1});continue}if(i===1&&e===0&&l===0){t.push({path:a,status:"deleted",isStaged:!0});continue}if(i===1&&e===0&&l===1){n.push({path:a,status:"deleted",isStaged:!1});continue}}return{branch:S().currentBranch,isRepoDirty:0<t.length+n.length+o.length,stagedFiles:t,unstagedFiles:n,untrackedFiles:o,aheadBy:0,behindBy:0,mergeInProgress:!1}}async function pe(){const r=O();if(r===null)return!1;try{const t=P();return await E.findRoot({fs:r,filepath:t}),!0}catch{return!1}}async function Re(){const r=S();if(O()!==null)try{const n=await pe();r.SetRepoInitialized(n),n&&(await T(),await ht(),await U())}catch{r.SetRepoInitialized(!1)}}async function Be(){const r=S(),t=O();if(t!==null)try{r.SetGitOperationInProgress(!0),r.SetGitOperationError(null),await E.init({fs:t,dir:P(),defaultBranch:"main"}),r.SetRepoInitialized(!0),r.SetCurrentBranch("main"),await T(),D(G.GIT_STATUS_CHANGED)}catch(n){r.SetGitOperationError(n.message)}finally{r.SetGitOperationInProgress(!1)}}async function Me(r,t,n,o){const s=S();try{s.SetGitOperationInProgress(!0),s.SetCurrentGitOperation("clone"),s.SetGitOperationProgress(0),s.SetGitOperationError(null),await E.clone({fs:t,http:L,dir:n,url:r,corsProxy:j(),singleBranch:!0,depth:1,onAuth:H(o),onProgress:c=>{c.total&&s.SetGitOperationProgress(Math.round(c.loaded/c.total*100))}}),s.SetRepoInitialized(!0),D(G.GIT_OPERATION_COMPLETE,{operation:"clone"})}catch(c){throw s.SetGitOperationError(c.message),c}finally{s.SetGitOperationInProgress(!1),s.SetCurrentGitOperation(null),s.SetGitOperationProgress(0)}}async function T(){const r=S(),t=O();if(!(t===null||!r.isRepoInitialized))try{const n=P();try{const c=await E.currentBranch({fs:t,dir:n,fullname:!1})||"HEAD";r.SetCurrentBranch(c)}catch{}const o=await E.statusMatrix({fs:t,dir:n}),s=_e(o);s.branch=r.currentBranch,r.SetGitStatus(s),D(G.GIT_STATUS_CHANGED)}catch{r.SetGitStatus(null)}}async function Ce(r){const t=O();if(t!==null)try{await E.add({fs:t,dir:P(),filepath:r}),await T()}catch(n){S().SetGitOperationError(n.message)}}async function Ae(){const t=S().gitStatus;if(t===null)return;const n=O();if(n===null)return;const o=P(),s=[...t.unstagedFiles.map(c=>c.path),...t.untrackedFiles.map(c=>c.path)];await Promise.allSettled(s.map(c=>E.add({fs:n,dir:o,filepath:c}))),await T()}async function Ne(r){const t=O();if(t!==null)try{await E.resetIndex({fs:t,dir:P(),filepath:r}),await T()}catch(n){S().SetGitOperationError(n.message)}}async function qe(r){const t=O();if(t!==null)try{await E.checkout({fs:t,dir:P(),filepaths:[r],force:!0}),await T()}catch(n){S().SetGitOperationError(n.message)}}async function ze(r){const t=S(),n=O();if(n===null)throw new Error("No filesystem available");try{t.SetGitOperationInProgress(!0),t.SetCurrentGitOperation("commit"),t.SetGitOperationError(null);const o=t.gitAuthor,s=await E.commit({fs:n,dir:P(),message:r,author:{name:o.name,email:o.email}});return await T(),await U(),D(G.GIT_OPERATION_COMPLETE,{operation:"commit",oid:s}),s}catch(o){throw t.SetGitOperationError(o.message),o}finally{t.SetGitOperationInProgress(!1),t.SetCurrentGitOperation(null)}}async function Le(r="origin"){const t=S(),n=O();if(n!==null)try{t.SetGitOperationInProgress(!0),t.SetCurrentGitOperation("push"),t.SetGitOperationError(null),await E.push({fs:n,http:L,dir:P(),remote:r,ref:t.currentBranch,corsProxy:j(),onAuth:H(),onProgress:o=>{o.total&&t.SetGitOperationProgress(Math.round(o.loaded/o.total*100))}}),await T(),D(G.GIT_OPERATION_COMPLETE,{operation:"push"})}catch(o){throw t.SetGitOperationError(o.message),o}finally{t.SetGitOperationInProgress(!1),t.SetCurrentGitOperation(null),t.SetGitOperationProgress(0)}}async function je(r="origin"){const t=S(),n=O();if(n!==null)try{t.SetGitOperationInProgress(!0),t.SetCurrentGitOperation("pull"),t.SetGitOperationError(null),await E.pull({fs:n,http:L,dir:P(),ref:t.currentBranch,singleBranch:!0,corsProxy:j(),onAuth:H(),author:{name:t.gitAuthor.name,email:t.gitAuthor.email}}),await T(),await U(),D(G.GIT_OPERATION_COMPLETE,{operation:"pull"})}catch(o){throw t.SetGitOperationError(o.message),o}finally{t.SetGitOperationInProgress(!1),t.SetCurrentGitOperation(null),t.SetGitOperationProgress(0)}}async function He(r="origin"){const t=S(),n=O();if(n!==null)try{t.SetGitOperationInProgress(!0),t.SetCurrentGitOperation("fetch"),t.SetGitOperationError(null),await E.fetch({fs:n,http:L,dir:P(),remote:r,corsProxy:j(),onAuth:H()}),await ht(),D(G.GIT_OPERATION_COMPLETE,{operation:"fetch"})}catch(o){t.SetGitOperationError(o.message)}finally{t.SetGitOperationInProgress(!1),t.SetCurrentGitOperation(null)}}async function ye(r){const t=S(),n=O();if(n!==null)try{t.SetGitOperationError(null),await E.checkout({fs:n,dir:P(),ref:r}),t.SetCurrentBranch(r),await T(),await U(),D(G.GIT_BRANCH_CHANGED,{branch:r})}catch(o){t.SetGitOperationError(o.message)}}async function Ue(r,t=!0){const n=S(),o=O();if(o!==null)try{n.SetGitOperationError(null),await E.branch({fs:o,dir:P(),ref:r}),t?await ye(r):await ht()}catch(s){n.SetGitOperationError(s.message)}}async function ht(){const r=S(),t=O();if(t!==null)try{const n=P(),o=await E.listBranches({fs:t,dir:n}),s=r.currentBranch,c=o.map(a=>({name:a,isRemote:!1,isCurrentBranch:a===s,lastCommitOid:""}));try{const a=await E.listBranches({fs:t,dir:n,remote:"origin"});for(const i of a)c.push({name:`origin/${i}`,isRemote:!0,isCurrentBranch:!1,lastCommitOid:""})}catch{}r.SetBranches(c);try{const i=(await E.listRemotes({fs:t,dir:n})).map(e=>({name:e.remote,url:e.url}));r.SetRemotes(i)}catch{r.SetRemotes([])}}catch{}}async function U(r=At){const t=S(),n=O();if(n!==null)try{const o=P(),c=(await E.log({fs:n,dir:o,depth:r})).map(a=>({oid:a.oid,message:a.commit.message,author:{name:a.commit.author.name,email:a.commit.author.email},timestamp:a.commit.author.timestamp}));t.SetCommitLog(c)}catch{t.SetCommitLog([])}}async function ge(r){const t=O();if(t===null)return null;try{const n=P(),o=await E.resolveRef({fs:t,dir:n,ref:"HEAD"}),{blob:s}=await E.readBlob({fs:t,dir:n,oid:o,filepath:r});return new TextDecoder().decode(s)}catch{return null}}async function $e(){var s;const r=S(),t=r.gitStatus;if(t===null||t.stagedFiles.length===0)return"";const n=[],o=t.stagedFiles.length;for(let c=0;c<o;c++){const a=t.stagedFiles[c];if(n.push(`${a.status}: ${a.path}`),a.status==="modified"){const i=await ge(a.path);if(i!==null){const e=i.split(`
`),m=(((s=r.tabs.find(w=>{var g;return(g=w.path)==null?void 0:g.endsWith(a.path)}))==null?void 0:s.content)||"").split(`
`).length-e.length;m!==0&&n.push(`  (${0<m?"+":""}${m} lines)`)}}}return n.join(`
`)}export{ut as C,B as D,He as F,ge as G,Re as I,Le as P,we as R,Ae as S,Ne as U,Me as a,ze as b,$e as c,Ue as d,Be as e,ye as f,je as g,Ce as h,qe as i,xe as j};
